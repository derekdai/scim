%define nam             @PACKAGE@
%define ver             @VERSION@
%define rel             1
%define build_config_socket	@SCIM_BUILD_CONFIG_SOCKET@
%define build_config_simple	@SCIM_BUILD_CONFIG_SIMPLE@
%define build_frontend_x11	@SCIM_BUILD_FRONTEND_X11@
%define build_frontend_socket	@SCIM_BUILD_FRONTEND_SOCKET@
%define build_imengine_rawcode	@SCIM_BUILD_IMENGINE_RAWCODE@
%define build_imengine_socket	@SCIM_BUILD_IMENGINE_SOCKET@
%define build_gtk2_immodule	@SCIM_BUILD_GTK2_IMMODULE@
%define build_scim_setup        @SCIM_BUILD_SCIM_SETUP@
%define build_panel_gtk         @SCIM_BUILD_PANEL_GTK@
%define build_gtk_utils         @SCIM_BUILD_GTK_UTILS@
%define build_x11_utils         @SCIM_BUILD_X11_UTILS@
%define build_filter_sctc       @SCIM_BUILD_FILTER_SCTC@

Summary:        Smart Chinese/Common Input Method platform
Name:           %{nam}
Version:        %{ver}
Release:        %{rel}
License:        LGPL
Group:          System Environment/Libraries
URL:            http://scim.freedesktop.org
BuildRoot:      %{_tmppath}/%{name}-%{version}-root

Source0:        %{name}-%{version}.tar.gz
#NoSource: 0

PreReq:         /sbin/ldconfig, /bin/sh

%if %{build_gtk_utils}
Requires:       glib2 >= 2.0.0
BuildRequires:  glib2-devel >= 2.0.0
Requires:       gtk2 >= @GTK_VERSION@
BuildRequires:  gtk2-devel >= @GTK_VERSION@
Requires:       pango >= 1.0.0
BuildRequires:  pango-devel >= 1.0.0
%endif

%if %{build_x11_utils}
Requires:       XFree86-libs >= 4.1.0
BuildRequires:  XFree86-devel >= 4.1.0
%endif

BuildRequires:  pkgconfig >= 0.12
BuildRequires:  meson
BuildRequires:  ninja-build

%description
SCIM is a developing platform to significant reduce the difficulty of 
input method development. 

%package devel
Summary:        Smart Chinese/Common Input Method platform
Group:          Development/Libraries
Requires:       %{name} = %{version}
Requires:       pkgconfig >= 0.12

%description devel
The scim-devel package includes the static libraries and header files
for the scim package.

Install scim-devel if you want to develop programs which will use
scim.

#--------------------------------------------------

%prep

%setup -n %{name}-%{version}

%build
%meson \
    -Dconfig-socket=%{?build_config_socket:true}%{!?build_config_socket:false} \
    -Dconfig-simple=%{?build_config_simple:true}%{!?build_config_simple:false} \
    -Dfrontend-x11=%{?build_frontend_x11:true}%{!?build_frontend_x11:false} \
    -Dfrontend-socket=%{?build_frontend_socket:true}%{!?build_frontend_socket:false} \
    -Dim-rawcode=%{?build_imengine_rawcode:true}%{!?build_imengine_rawcode:false} \
    -Dim-socket=%{?build_imengine_socket:true}%{!?build_imengine_socket:false} \
    -Dfilter-sctc=%{?build_filter_sctc:true}%{!?build_filter_sctc:false} \
    -Dgtk2-immodule=%{?build_gtk2_immodule:true}%{!?build_gtk2_immodule:false} \
    -Dsetup-ui=%{?build_scim_setup:true}%{!?build_scim_setup:false} \
    -Dpanel-gtk=auto

%meson_build

%install
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

%meson_install

# install user manual (if not handled by meson install)
mkdir -p %{buildroot}/docs/dist/manual/zh_CN/figures/
# Check if docs are generated/installed, for now copy if present in source
# cp -a docs/manual/zh_CN/user-manual.{html,xml} %{buildroot}/docs/dist/manual/zh_CN/
# cp -a docs/manual/zh_CN/figures/*.png %{buildroot}/docs/dist/manual/zh_CN/figures/

%clean
[ -n "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf $RPM_BUILD_ROOT

%post
/sbin/ldconfig

%if %{build_gtk2_immodule}
gtk-query-immodules-2.0 > %{_sysconfdir}/gtk-2.0/gtk.immodules
%endif

%postun
/sbin/ldconfig

%if %{build_gtk2_immodule}
gtk-query-immodules-2.0 > %{_sysconfdir}/gtk-2.0/gtk.immodules
%endif


%files
%defattr(-, root, root)
%doc AUTHORS COPYING NEWS README ChangeLog TODO
# %doc docs/dist/manual/zh_CN
%dir %{_sysconfdir}/scim
%dir %{_libdir}/scim@SCIM_EPOCH@/*/FrontEnd
%dir %{_libdir}/scim@SCIM_EPOCH@/*/IMEngine
%dir %{_libdir}/scim@SCIM_EPOCH@/*/Config
%dir %{_libdir}/scim@SCIM_EPOCH@/*/SetupUI
%dir %{_libdir}/scim@SCIM_EPOCH@/*/Helper
%dir %{_libdir}/scim@SCIM_EPOCH@/*/Filter
%dir %{_libdir}/scim@SCIM_EPOCH@/Config
%dir %{_libdir}/scim@SCIM_EPOCH@/FrontEnd
%dir %{_libdir}/scim@SCIM_EPOCH@/IMEngine
%dir %{_libdir}/scim@SCIM_EPOCH@/SetupUI
%dir %{_libdir}/scim@SCIM_EPOCH@/Helper
%dir %{_libdir}/scim@SCIM_EPOCH@/Filter
%dir %{_datadir}/scim
%dir %{_datadir}/scim/icons
%config %{_sysconfdir}/scim/global
%{_bindir}/scim
%{_bindir}/scim-config-agent
%{_libdir}/libscim*.so.*
%{_libdir}/scim@SCIM_EPOCH@/scim-launcher
%{_libdir}/scim@SCIM_EPOCH@/scim-helper-launcher
%{_libdir}/scim@SCIM_EPOCH@/scim-helper-manager
# %{_datadir}/locale/*/LC_MESSAGES/scim.mo
%{_datadir}/scim/icons/keyboard.png
%{_datadir}/scim/icons/up.png
%{_datadir}/scim/icons/down.png
%{_datadir}/scim/icons/left.png
%{_datadir}/scim/icons/right.png
%{_datadir}/scim/icons/full-letter.png
%{_datadir}/scim/icons/half-letter.png
%{_datadir}/scim/icons/full-punct.png
%{_datadir}/scim/icons/half-punct.png
%{_datadir}/scim/icons/help.png
%{_datadir}/scim/icons/pin-up.png
%{_datadir}/scim/icons/pin-down.png
%{_datadir}/scim/icons/setup.png
%{_datadir}/scim/icons/trademark.png
%{_datadir}/scim/icons/menu.png
%if %{build_scim_setup}
%{_bindir}/scim-setup
%{_datadir}/applications/scim-setup.desktop
%{_datadir}/control-center-2.0/capplets/scim-setup.desktop
%{_datadir}/pixmaps/scim-setup.png
%{_libdir}/scim@SCIM_EPOCH@/*/Helper/setup.so
%{_libdir}/scim@SCIM_EPOCH@/*/SetupUI/aaa-frontend-setup.so
%{_libdir}/scim@SCIM_EPOCH@/*/SetupUI/aaa-imengine-setup.so
%endif
%if %{build_panel_gtk}
%{_libdir}/scim@SCIM_EPOCH@/scim-panel-gtk
%if %{build_scim_setup}
%{_libdir}/scim@SCIM_EPOCH@/*/SetupUI/panel-gtk-setup.so
%endif
%endif
%if %{build_frontend_x11}
%{_libdir}/scim@SCIM_EPOCH@/*/FrontEnd/x11-frontend.so
%endif
%if %{build_imengine_rawcode}
%{_libdir}/scim@SCIM_EPOCH@/*/IMEngine/rawcode.so
%{_datadir}/scim/icons/rawcode.png
%endif
%if %{build_filter_sctc}
%{_libdir}/scim@SCIM_EPOCH@/*/Filter/sctc.so
%{_datadir}/scim/icons/sctc.png
%{_datadir}/scim/icons/sctc-sc-to-tc.png
%{_datadir}/scim/icons/sctc-tc-to-sc.png
%endif
%if %{build_config_simple}
%config %{_sysconfdir}/scim/config
%{_libdir}/scim@SCIM_EPOCH@/*/Config/simple.so
%endif
%if %{build_imengine_socket}
%{_libdir}/scim@SCIM_EPOCH@/*/IMEngine/socket.so
%endif
%if %{build_frontend_socket}
%{_libdir}/scim@SCIM_EPOCH@/*/FrontEnd/socket-frontend.so
%endif
%if %{build_config_socket}
%{_libdir}/scim@SCIM_EPOCH@/*/Config/socket.so
%endif
%if %{build_gtk2_immodule}
@GTK_LIBDIR@/gtk-2.0/immodules/im-scim.so
%endif

%files devel
%defattr(-, root, root)
# %doc docs/html
# %doc docs/developers
%{_libdir}/libscim*.so
%{_libdir}/pkgconfig/*.pc
%{_includedir}/scim@SCIM_EPOCH@

%changelog
* Sun Jan 5 2026 Derek <116649+derekdai@users.noreply.github.com>
- Migrate to Meson build system
