#!/usr/bin/make -f
export DH_VERBOSE=1
export DEB_HOST_MULTIARCH ?= $(shell dpkg-architecture -qDEB_HOST_MULTIARCH)

%:
	dh $@ --buildsystem=meson

override_dh_auto_configure:
	dh_auto_configure -- \
		-Dgtk2-immodule=true \
		-Dgtk3-immodule=true \
		-Dclutter-immodule=true \
		-Dqt3-immodule=false \
		-Dqt4-immodule=false \
		-Dqt5-immodule=true

override_dh_auto_install:
	dh_auto_install
	# empty the dependency_libs field in .la files if any (Meson doesn't usually generate them, but kept for safety if wrappers do)
	find debian/tmp/usr/lib/ -name *.la -exec sed -i "/dependency_libs/ s/'.*'/''/" {} \; || true

override_dh_install-arch:
	dh_install
	# Adjust path for xinput script if needed, or ensure it is installed correctly
	# meson install should handle most, but we might need to sed the file
	if [ -f debian/scim/etc/X11/xinit/xinput.d/scim-immodule ]; then \
		sed -i -e 's/@DEB_HOST_MULTIARCH@/$(DEB_HOST_MULTIARCH)/g' debian/scim/etc/X11/xinit/xinput.d/scim-immodule; \
	fi

override_dh_makeshlibs:
	dh_makeshlibs -p libscim8v5 -V "libscim8v5 (>= 1.4)"

override_dh_shlibdeps:
	dh_shlibdeps -l debian/libscim8v5/usr/lib -L libscim8v5
